{
  "hash": "84f9a898191c69de801a700ebef4507f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take-Home_Exercise 1\"\nauthor: \"Qu JunJie\"\ndate: \"09 Sep 2024\"\ndate-modified: \"last-modified\"\nexecute: \n  eval: true\n  echo: true\n  message: false\n  freeze: true\n  warning: false\n---\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(sf, tidyverse, tmap, spNetwork)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#! eval:false\nacc <- read_csv(\"data/rawdata/thai_road_accident_2019_2022.csv\") %>%\n  mutate(Month_num = month(incident_datetime)) %>%\n  mutate(Month_fac = month(incident_datetime,\n                       label = TRUE,\n                       abbr = TRUE)) %>%\n  mutate(dayofweek = weekdays(incident_datetime))%>%\n  filter(!is.na(longitude) & !is.na(latitude)) %>%  # Remove rows with missing coordinates\n  st_as_sf(coords = c(\"longitude\", \"latitude\"),\n                       crs=4326) %>%\n  st_transform(crs = 32647)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(acc, \"data/rds/acc.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nacc <- read_rds(\"data/rds/acc.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbangkok_acc_data <- acc %>%\n  filter(province_en == \"Bangkok\")\nhead(bangkok_acc_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 19 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 645371.9 ymin: 1506578 xmax: 684102 ymax: 1525144\nProjected CRS: WGS 84 / UTM zone 47N\n# A tibble: 6 × 20\n  acc_code incident_datetime   report_datetime     province_th  province_en\n     <dbl> <dttm>              <dttm>              <chr>        <chr>      \n1   629691 2019-01-01 03:05:00 2019-01-01 03:05:00 กรุงเทพมหานคร Bangkok    \n2   629689 2019-01-01 05:42:00 2019-01-01 05:42:00 กรุงเทพมหานคร Bangkok    \n3   604307 2019-01-01 10:10:00 2019-03-06 10:49:00 กรุงเทพมหานคร Bangkok    \n4  3793736 2019-01-01 17:30:00 2020-03-11 13:15:00 กรุงเทพมหานคร Bangkok    \n5   599070 2019-01-01 19:20:00 2019-01-01 20:57:00 กรุงเทพมหานคร Bangkok    \n6   613605 2019-01-01 21:40:00 2019-11-18 10:57:00 กรุงเทพมหานคร Bangkok    \n# ℹ 15 more variables: agency <chr>, route <chr>, vehicle_type <chr>,\n#   presumed_cause <chr>, accident_type <chr>,\n#   number_of_vehicles_involved <dbl>, number_of_fatalities <dbl>,\n#   number_of_injuries <dbl>, weather_condition <chr>, road_description <chr>,\n#   slope_description <chr>, Month_num <dbl>, Month_fac <ord>, dayofweek <chr>,\n#   geometry <POINT [m]>\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(bangkok_acc_data,\"data/rds/bangkok_acc_data.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbangkok_acc_data <- read_rds(\"data/rds/bangkok_acc_data.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_one_map <- st_read(dsn = \"data/rawdata\",\n                        layer = \"hotosm_tha_roads_lines_shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `hotosm_tha_roads_lines_shp' from data source \n  `D:\\SMUJunJie\\ISSS626-GAA\\Take-Home_Ex\\Take-Home_Ex01\\data\\rawdata' \n  using driver `ESRI Shapefile'\nSimple feature collection with 2792590 features and 14 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 97.34457 ymin: 5.643645 xmax: 105.6528 ymax: 20.47168\nCRS:           NA\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_one_map\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 2792590 features and 14 fields\nGeometry type: MULTILINESTRING\nDimension:     XY\nBounding box:  xmin: 97.34457 ymin: 5.643645 xmax: 105.6528 ymax: 20.47168\nCRS:           NA\nFirst 10 features:\n             name               name_en        highway  surface smoothness\n1      ถนนฉลองกรุง    Chalong Krung Road      secondary    paved       <NA>\n2  ซอยฉลองกรุง 1/1 Soi Chalong Krung 1/1    residential     <NA>       <NA>\n3            <NA>                  <NA> secondary_link     <NA>       <NA>\n4            <NA>                  <NA>        service     <NA>       <NA>\n5      ถนนฉลองกรุง    Chalong Krung Road      secondary concrete       <NA>\n6            <NA>                  <NA>        service     <NA>       <NA>\n7     ถนนเอราวัณ 1         Erawan 1 Road       tertiary     <NA>       <NA>\n8            <NA>                  <NA>           path  unpaved       <NA>\n9            <NA>                  <NA>        service     <NA>       <NA>\n10           <NA>                  <NA>    residential     <NA>       <NA>\n   width lanes oneway bridge layer source        name_th     osm_id  osm_type\n1   <NA>  <NA>    yes   <NA>  <NA>   <NA>     ถนนฉลองกรุง 1125681229 ways_line\n2   <NA>  <NA>   <NA>   <NA>  <NA>   <NA> ซอยฉลองกรุง 1/1  594401607 ways_line\n3   <NA>  <NA>    yes   <NA>  <NA>   <NA>           <NA>  472283206 ways_line\n4   <NA>  <NA>   <NA>   <NA>  <NA>   <NA>           <NA>  594401608 ways_line\n5   <NA>     2    yes    yes     1   Bing     ถนนฉลองกรุง  116847248 ways_line\n6   <NA>  <NA>   <NA>   <NA>  <NA>   <NA>           <NA>  317485095 ways_line\n7   <NA>  <NA>   <NA>   <NA>  <NA>   <NA>    ถนนเอราวัณ 1  378672881 ways_line\n8   <NA>  <NA>   <NA>   <NA>  <NA>    GPS           <NA> 1238351123 ways_line\n9   <NA>  <NA>   <NA>   <NA>  <NA>   <NA>           <NA>  909942692 ways_line\n10  <NA>  <NA>   <NA>   <NA>  <NA>   <NA>           <NA>  694824299 ways_line\n                         geometry\n1  MULTILINESTRING ((100.7913 ...\n2  MULTILINESTRING ((100.7882 ...\n3  MULTILINESTRING ((100.7844 ...\n4  MULTILINESTRING ((100.7873 ...\n5  MULTILINESTRING ((100.7831 ...\n6  MULTILINESTRING ((100.7931 ...\n7  MULTILINESTRING ((100.6416 ...\n8  MULTILINESTRING ((98.87378 ...\n9  MULTILINESTRING ((100.193 1...\n10 MULTILINESTRING ((100.1994 ...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nst_crs(thai_one_map)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nCoordinate Reference System: NA\n```\n\n\n:::\n\n```{.r .cell-code}\n# 设置 CRS 为 WGS 84 (EPSG:4326)\nst_crs(thai_one_map) <- 4326\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 将道路数据的 CRS 转换为与事故数据相同的 CRS\nthai_one_map <- st_transform(thai_one_map, st_crs(bangkok_acc_data))\n\nmatched_with_roads <- st_join(bangkok_acc_data, thai_one_map, join = st_nearest_feature)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(matched_with_roads)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 33 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 645371.9 ymin: 1506578 xmax: 684102 ymax: 1525144\nProjected CRS: WGS 84 / UTM zone 47N\n# A tibble: 6 × 34\n  acc_code incident_datetime   report_datetime     province_th  province_en\n     <dbl> <dttm>              <dttm>              <chr>        <chr>      \n1   629691 2019-01-01 03:05:00 2019-01-01 03:05:00 กรุงเทพมหานคร Bangkok    \n2   629689 2019-01-01 05:42:00 2019-01-01 05:42:00 กรุงเทพมหานคร Bangkok    \n3   604307 2019-01-01 10:10:00 2019-03-06 10:49:00 กรุงเทพมหานคร Bangkok    \n4  3793736 2019-01-01 17:30:00 2020-03-11 13:15:00 กรุงเทพมหานคร Bangkok    \n5   599070 2019-01-01 19:20:00 2019-01-01 20:57:00 กรุงเทพมหานคร Bangkok    \n6   613605 2019-01-01 21:40:00 2019-11-18 10:57:00 กรุงเทพมหานคร Bangkok    \n# ℹ 29 more variables: agency <chr>, route <chr>, vehicle_type <chr>,\n#   presumed_cause <chr>, accident_type <chr>,\n#   number_of_vehicles_involved <dbl>, number_of_fatalities <dbl>,\n#   number_of_injuries <dbl>, weather_condition <chr>, road_description <chr>,\n#   slope_description <chr>, Month_num <dbl>, Month_fac <ord>, dayofweek <chr>,\n#   geometry <POINT [m]>, name <chr>, name_en <chr>, highway <chr>,\n#   surface <chr>, smoothness <chr>, width <chr>, lanes <chr>, oneway <chr>, …\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(matched_with_roads))\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex01_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nthai_Administrative <- st_read(dsn = \"data/rawdata\",\n                                          layer = \"tha_admbnda_adm0_rtsd_20220121\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `tha_admbnda_adm0_rtsd_20220121' from data source \n  `D:\\SMUJunJie\\ISSS626-GAA\\Take-Home_Ex\\Take-Home_Ex01\\data\\rawdata' \n  using driver `ESRI Shapefile'\nSimple feature collection with 1 feature and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n```{.r .cell-code}\nthai_Administrative\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 13 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 97.34336 ymin: 5.613038 xmax: 105.637 ymax: 20.46507\nGeodetic CRS:  WGS 84\n  Shape_Leng Shape_Area  ADM0_EN   ADM0_TH ADM0_PCODE ADM0_REF ADM0ALT1EN\n1   106.6359   43.40351 Thailand ประเทศไทย         TH     <NA>       <NA>\n  ADM0ALT2EN ADM0ALT1TH ADM0ALT2TH       date    validOn    validTo\n1       <NA>       <NA>       <NA> 2019-02-18 2022-01-22 -001-11-30\n                        geometry\n1 MULTIPOLYGON (((100.0903 6....\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(st_geometry(bangkok_acc_data))\n```\n\n::: {.cell-output-display}\n![](Take-Home_Ex01_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Take-Home_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}